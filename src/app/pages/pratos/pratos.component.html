<nz-skeleton [nzActive]="true" [nzLoading]="loading"></nz-skeleton>

<button
  nz-button
  nzType="primary"
  style="margin-bottom: 10px"
  (click)="isVisible = true"
>
  Novo Prato
</button>

<nz-collapse>
  @for (grupo of data$ | async; track grupo._id) {
  <nz-collapse-panel [nzHeader]="tplTitulo" [nzExtra]="tplExtra">
    <nz-list nzItemLayout="horizontal" nzBordered nzSize="large">
      <nz-list-item *ngFor="let item of grupo.pratos">
        {{ item.nome }}

        <ul nz-list-item-actions>
          <nz-list-item-action>
            <button
              nz-button
              nzType="dashed"
              nz-tooltip="Editar"
              (click)="editar(item)"
            >
              <span nz-icon nzType="edit" nzTheme="outline"></span>
            </button>
          </nz-list-item-action>
          <nz-list-item-action>
            <button
              nzDanger
              nz-button
              nzType="dashed"
              nz-tooltip="Remover"
              nz-popconfirm
              nzPopconfirmTitle="Deseja remover esse registro?"
              nzPopconfirmPlacement="bottom"
              (nzOnConfirm)="remover(item)"
            >
              <span nz-icon nzType="delete" nzTheme="outline"></span>
            </button>
          </nz-list-item-action>
        </ul>
      </nz-list-item>
    </nz-list>
  </nz-collapse-panel>
  <ng-template #tplTitulo>
    <div class="fx-row wf" style="margin-right: 10px">
      <div class="fx-flex">
        <ng-container
          *ngTemplateOutlet="tplPrincipal; context: { $implicit: grupo }"
        ></ng-container>
        {{ grupo.nome }}
      </div>
      @if(grupo.pratos.length){
      {{ grupo.pratos.length }}
      }
    </div>
  </ng-template>
  <ng-template #tplExtra>
    <span
      nz-icon
      nzType="plus"
      nzTheme="outline"
      (click)="$event.stopPropagation(); novoPratoGrupo(grupo)"
    ></span>
  </ng-template>
  }
</nz-collapse>

<nz-modal
  [(nzVisible)]="isVisible"
  nzTitle="Prato"
  (nzOnCancel)="isVisible = false"
  (nzOnOk)="salvar()"
>
  <ng-container *nzModalContent>
    <form nz-form [formGroup]="validateForm" nzLayout="vertical">
      <nz-form-item>
        <nz-form-label [nzSm]="8" [nzXs]="24" nzRequired>Nome</nz-form-label>
        <nz-form-control
          [nzSm]="16"
          [nzXs]="24"
          nzErrorTip="Por favor informe aqui o nome do prato!"
        >
          <nz-input-group>
            <input
              type="text"
              nz-input
              formControlName="nome"
              placeholder="Informe aqui o nome do prato"
            />
          </nz-input-group>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label [nzSpan]="5" nzRequired>Grupo</nz-form-label>
        <nz-form-control
          [nzSpan]="12"
          nzErrorTip="Por favor informe um grupo do prato!"
        >
          <nz-select
            formControlName="grupo"
            placeholder="Informe aqui o grupo do prato"
          >
            @for(g of grupos; track g._id){
            <nz-option nzCustomContent [nzValue]="g._id" [nzLabel]="g.nome!">
              <ng-container
                *ngTemplateOutlet="tplPrincipal; context: { $implicit: g }"
              ></ng-container>
              {{ g.nome }}
            </nz-option>
            }
          </nz-select>
        </nz-form-control>
      </nz-form-item>
    </form>
  </ng-container>
</nz-modal>

<ng-template #tplPrincipal let-grupo>
  <nz-badge [nzStatus]="grupo.principal ? 'success' : 'default'"></nz-badge>
</ng-template>
